{% extends 'base-other-page.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Reset Password" %}{% endblock %}

{% block content %}
<div class="row m-0">
    <div class="col-12 p-0">    
        <div class="login-card">
            <div>
                <div>
                    <a class="logo" href="{% url 'adminlogin' %}">
                        <img class="img-fluid for-light" style="width: 240px; height: 70px;" src="{{ footer_logo }}" alt="loginpage">
                        <img class="img-fluid for-dark" src="{{ footer_logo }}" alt="loginpage">
                    </a>
                </div>
                <div class="login-main"> 
                    <form class="theme-form" method="post" id="resetPasswordForm" novalidate>
                        {% csrf_token %}
                        <h4>{% trans "Reset Password" %}</h4>
                        
                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} mb-3">
                                    {{ message }}
                                </div>
                            {% endfor %}
                        {% endif %}

                        <div class="form-group position-relative">
                            <label class="col-form-label">{% trans "New Password" %}</label>
                            <input type="password" class="form-control" name="password" id="password" 
                                   placeholder="{% trans 'Enter new password' %}" required>
                            <i class="fa fa-eye toggle-password" toggle="#password"></i>
                            <small class="form-text text-muted">
                                {% trans "Minimum 8 characters" %}
                            </small>
                        </div>
                        
                        <div class="form-group position-relative">
                            <label class="col-form-label">{% trans "Confirm Password" %}</label>
                            <input type="password" class="form-control" name="confirm_password" id="confirm_password" 
                                   placeholder="{% trans 'Confirm new password' %}" required>
                            <i class="fa fa-eye toggle-password" toggle="#confirm_password"></i>
                        </div>

                        <div class="form-group mb-0">
                            <div class="text-end mt-3">
                                <button class="btn btn-primary btn-block w-100" type="submit">
                                    {% trans "Reset Password" %}
                                </button>
                            </div>
                        </div>
                        
                        <div class="text-center mt-3">
                            <a href="{% url 'adminlogin' %}" class="text-muted">
                                {% trans "Back to Login" %}
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scriptscontent %}
<!-- Font Awesome for eye icon -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- Optional: Add custom style for eye icon -->
<style>
    .toggle-password {
        position: absolute;
        top: 47px;
        right: 15px;
        cursor: pointer;
        color: #888;
        z-index: 2;
    }
</style>

<!-- jQuery Validate -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>

<script>
$(document).ready(function() {
    // Form validation
    $("#resetPasswordForm").validate({
        rules: {
            password: {
                required: true,
                minlength: 8
            },
            confirm_password: {
                required: true,
                minlength: 8,
                equalTo: "#password"
            }
        },
        messages: {
            password: {
                required: "{% trans 'Please enter a password' %}",
                minlength: "{% trans 'Password must be at least 8 characters' %}"
            },
            confirm_password: {
                required: "{% trans 'Please confirm your password' %}",
                minlength: "{% trans 'Password must be at least 8 characters' %}",
                equalTo: "{% trans 'Passwords do not match' %}"
            }
        },
        errorClass: "is-invalid",
        validClass: "is-valid",
        errorElement: "div",
        highlight: function(element) {
            $(element).addClass("is-invalid").removeClass("is-valid");
        },
        unhighlight: function(element) {
            $(element).removeClass("is-invalid").addClass("is-valid");
        },
        errorPlacement: function(error, element) {
            error.addClass("invalid-feedback");
            error.insertAfter(element);
        }
    });

    // Toggle Password Visibility
    $(".toggle-password").click(function() {
        let input = $($(this).attr("toggle"));
        if (input.attr("type") === "password") {
            input.attr("type", "text");
            $(this).removeClass("fa-eye").addClass("fa-eye-slash");
        } else {
            input.attr("type", "password");
            $(this).removeClass("fa-eye-slash").addClass("fa-eye");
        }
    });
});
</script>
{% endblock %}
